<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Decision Engine</title>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #111;
    color: white;
    text-align: center;
    padding: 20px;
}
textarea, input {
    width: 90%;
    padding: 10px;
    margin: 10px 0;
}
button {
    padding: 12px 18px;
    margin: 6px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
}
.primary { background: #00c896; color: black; }
.danger { background: #ff5c5c; }
.secondary { background: #333; color: white; }
.card {
    border: 1px solid #333;
    padding: 20px;
    margin: 10px;
    border-radius: 12px;
}
#robot {
    margin: 20px 0;
    font-style: italic;
    opacity: 0.8;
}
</style>
</head>
<body>

<h2>Robot Decision Engine</h2>

<div id="setup">
<textarea id="items" rows="8" placeholder="Paste items, one per line"></textarea>
<input type="number" id="target" placeholder="How many to KEEP?">
<br>
<button class="primary" onclick="start()">Start</button>
</div>

<div id="compare" style="display:none;">
<div id="robot"></div>
<div class="card" id="choiceA"></div>
<button onclick="choose('A')" class="primary">Choose A</button>
<button onclick="choose('B')" class="primary">Choose B</button>
<br>
<button onclick="forceKeep('A')" class="secondary">Keep A</button>
<button onclick="forceKeep('B')" class="secondary">Keep B</button>
<br>
<button onclick="forceDiscard('A')" class="danger">Discard A</button>
<button onclick="forceDiscard('B')" class="danger">Discard B</button>
<br>
<button onclick="goBack()" class="secondary">Back</button>
<button onclick="resetAll()" class="danger">Reset</button>
</div>

<div id="results" style="display:none;"></div>

<script>

let items = [];
let target = 0;
let stack = [];
let history = [];
let keepForced = [];
let discardForced = [];
let left, right, merged;
let mergeStack = [];
let robotLines = [
"Ah. Another human overwhelmed.",
"Interesting choice. Predictable.",
"You hesitated. I noticed.",
"You are revealing yourself.",
"This is statistically fascinating.",
"Your priorities are forming.",
"You cannot hide from preference logic.",
"Consistency detected. Suspicious.",
"Fewer items remain. Pressure increasing.",
"Ranking almost complete. No escape now."
];

function randomRobot() {
    return robotLines[Math.floor(Math.random()*robotLines.length)];
}

function start() {
    items = document.getElementById("items").value
        .split("\n")
        .map(x => x.trim())
        .filter(x => x.length);

    target = parseInt(document.getElementById("target").value);

    if (!items.length || !target || target > items.length) {
        alert("Invalid input.");
        return;
    }

    keepForced = [];
    discardForced = [];
    history = [];

    stack = items.map(item => [item]);

    document.getElementById("setup").style.display = "none";
    document.getElementById("compare").style.display = "block";

    nextMerge();
}

function nextMerge() {
    if (stack.length === 1) {
        finish();
        return;
    }

    let a = stack.shift();
    let b = stack.shift();

    left = [...a];
    right = [...b];
    merged = [];

    mergeStack.push([a,b]);
    showComparison();
}

function showComparison() {
    if (!left.length) {
        merged = merged.concat(right);
        stack.push(merged);
        nextMerge();
        return;
    }
    if (!right.length) {
        merged = merged.concat(left);
        stack.push(merged);
        nextMerge();
        return;
    }

    document.getElementById("choiceA").innerHTML =
        "<h3>A</h3>" + left[0] +
        "<h3>B</h3>" + right[0];

    document.getElementById("robot").innerText = randomRobot();
}

function choose(side) {
    history.push({
        left:[...left],
        right:[...right],
        merged:[...merged],
        stack:[...stack]
    });

    if (side === "A") {
        merged.push(left.shift());
    } else {
        merged.push(right.shift());
    }

    showComparison();
}

function forceKeep(side) {
    let item = side === "A" ? left.shift() : right.shift();
    keepForced.push(item);
    showComparison();
}

function forceDiscard(side) {
    let item = side === "A" ? left.shift() : right.shift();
    discardForced.push(item);
    showComparison();
}

function goBack() {
    if (!history.length) return;
    let prev = history.pop();
    left = prev.left;
    right = prev.right;
    merged = prev.merged;
    stack = prev.stack;
    showComparison();
}

function finish() {
    let ranked = stack[0];

    ranked = keepForced.concat(ranked.filter(x => !keepForced.includes(x)));
    ranked = ranked.filter(x => !discardForced.includes(x));

    let keep = ranked.slice(0,target);
    let discard = ranked.slice(target).concat(discardForced);

    document.getElementById("compare").style.display = "none";
    document.getElementById("results").style.display = "block";

    document.getElementById("results").innerHTML =
        "<h3>KEEP</h3>" + keep.join("<br>") +
        "<h3>DISCARD</h3>" + discard.join("<br>") +
        "<br><button onclick='resetAll()'>Start Over</button>";

}

function resetAll() {
    location.reload();
}

</script>

</body>
</html>
