<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#000000">
<title>DECIDOR</title>

<style>
:root{
--green:#66ff66;
--glow:rgba(102,255,102,0.6);
--metal1:#2b2b2b;
--metal2:#1a1a1a;
--fire1:#1a0606;
--fire2:#5a1200;
--fire3:#c22d00;
}

/* Base */
html,body{
margin:0;
font-family:Arial,Helvetica,sans-serif;
background:
radial-gradient(circle at 20% 20%,var(--fire3),transparent 50%),
radial-gradient(circle at 80% 80%,var(--fire2),transparent 50%),
linear-gradient(180deg,var(--fire1),#000);
color:white;
}

body{
min-height:100dvh;
overflow-y:auto;
display:flex;
flex-direction:column;
align-items:center;
}

body.locked{
height:100dvh;
overflow:hidden;
}

/* TITLE UPGRADE */

h1{
margin:12px 0 10px;
font-size:34px;
font-weight:900;
letter-spacing:6px;
background:linear-gradient(180deg,#fff3c4,#ffb347,#ff7a00);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
text-shadow:
0 3px 0 #000,
0 0 10px rgba(255,140,0,0.6);
animation:pulse 2.5s infinite ease-in-out;
}

@keyframes pulse{
0%{transform:scale(1);}
50%{transform:scale(1.05);}
100%{transform:scale(1);}
}

/* Panels */

.glass{
background:linear-gradient(145deg,var(--metal1),var(--metal2));
border:3px solid #000;
border-radius:12px;
padding:12px;
width:95%;
max-width:430px;
box-sizing:border-box;
box-shadow:
inset 0 2px 3px rgba(255,255,255,0.05),
inset 0 -3px 6px rgba(0,0,0,0.7),
0 8px 20px rgba(0,0,0,0.8);
margin-bottom:12px;
}

textarea,input{
width:100%;
padding:8px;
margin-bottom:6px;
box-sizing:border-box;
background:black;
border:2px solid #111;
border-radius:6px;
color:var(--green);
font-family:monospace;
font-size:14px;
box-shadow:
inset 0 0 10px rgba(0,0,0,0.9),
0 0 5px var(--glow);
}

button{
width:100%;
padding:8px;
margin:4px 0;
font-size:13px;
font-weight:800;
border-radius:6px;
border:2px solid #000;
text-transform:uppercase;
cursor:pointer;
}

button:active{transform:translateY(1px);}

.primary{background:linear-gradient(#ff7a00,#a63300);color:white;}
.keep{background:linear-gradient(#33cc33,#1b6b1b);color:white;}
.danger{background:linear-gradient(#ff3b30,#8b0000);color:white;}
.secondary{background:linear-gradient(#555,#222);color:white;}

.card{
background:black;
border:2px solid #222;
padding:10px;
margin:6px 0;
font-family:monospace;
font-size:14px;
text-align:center;
color:var(--green);
box-shadow:
inset 0 0 10px rgba(0,0,0,0.9),
0 0 6px var(--glow);
}

/* Duplicate colours */
.yellow{color:#ffd700;}
.red{color:#ff4444;}

/* CRT */
body::after{
content:"";
position:fixed;
top:0;left:0;
width:100%;height:100%;
pointer-events:none;
background:repeating-linear-gradient(
0deg,
rgba(255,255,255,0.03),
rgba(255,255,255,0.03) 1px,
transparent 1px,
transparent 3px
);
animation:flicker 0.15s infinite;
}

@keyframes flicker{
0%{opacity:0.95;}
50%{opacity:1;}
100%{opacity:0.96;}
}

.progress{
height:5px;
background:#111;
border:1px solid #000;
border-radius:4px;
overflow:hidden;
margin:4px 0 8px;
}

.progress-bar{
height:100%;
width:0%;
background:#00ff66;
transition:width 0.2s ease;
}

#robotFace{
height:50px;
background:black;
border:2px solid #222;
border-radius:6px;
display:flex;
align-items:center;
justify-content:center;
font-family:monospace;
font-size:22px;
color:var(--green);
margin-bottom:6px;
box-shadow:0 0 6px var(--glow);
}

.hidden{display:none;}
</style>
</head>

<body>

<h1>DECIDOR</h1>

<div id="setup" class="glass">
<textarea id="items" rows="4" placeholder="ENTER ITEMS (ONE PER LINE)"></textarea>
<input type="number" id="target" placeholder="TARGET NUMBER">
<button class="primary" onclick="start()">START</button>
</div>

<div id="compare" class="glass hidden">
<div id="robotFace">-_-</div>
<div class="progress"><div class="progress-bar" id="progress"></div></div>
<div id="counter"></div>

<div class="card" id="cardA"></div>
<button class="primary" onclick="choose('A')">CHOOSE A</button>

<div class="card" id="cardB"></div>
<button class="primary" onclick="choose('B')">CHOOSE B</button>

<button class="keep" onclick="forceKeep('A')">KEEP A</button>
<button class="keep" onclick="forceKeep('B')">KEEP B</button>

<button class="danger" onclick="forceDiscard('A')">DISCARD A</button>
<button class="danger" onclick="forceDiscard('B')">DISCARD B</button>

<button class="secondary" onclick="goBack()">BACK</button>
<button class="secondary" onclick="resetAll()">RESET</button>
</div>

<div id="results" class="glass hidden"></div>

<script>
let items=[],target=0;
let stack=[],left=[],right=[],merged=[];
let history=[],keepForced=[],discardForced=[];
let comparisons=0,estimatedTotal=0;

const faces=["-_-","o_o","^_^","¬_¬","O_O","x_x"];

function bootSound(){
let ctx=new (window.AudioContext||window.webkitAudioContext)();
let osc=ctx.createOscillator();
osc.type="square";
osc.frequency.value=200;
osc.connect(ctx.destination);
osc.start();
osc.frequency.linearRampToValueAtTime(600,ctx.currentTime+0.2);
osc.stop(ctx.currentTime+0.25);
}

function animateFace(){
document.getElementById("robotFace").innerText=
faces[Math.floor(Math.random()*faces.length)];
}
setInterval(animateFace,800);

function start(){
bootSound();
document.body.classList.add("locked");

items=document.getElementById("items").value.split("\n").map(x=>x.trim()).filter(Boolean);
target=parseInt(document.getElementById("target").value);
if(!items.length||!target||target>items.length){alert("CHECK INPUTS");return;}

stack=items.map(i=>[i]);
estimatedTotal=Math.ceil(items.length*Math.log2(items.length));
comparisons=0;history=[];keepForced=[];discardForced=[];
document.getElementById("setup").classList.add("hidden");
document.getElementById("compare").classList.remove("hidden");
nextMerge();
}

function nextMerge(){
if(stack.length===1){finish();return;}
left=stack.shift();right=stack.shift();merged=[];
show();
}

function show(){
if(!left.length){stack.push(merged.concat(right));nextMerge();return;}
if(!right.length){stack.push(merged.concat(left));nextMerge();return;}
document.getElementById("cardA").innerText=left[0];
document.getElementById("cardB").innerText=right[0];
document.getElementById("counter").innerText=
"COMPARISON "+comparisons+" OF ~"+estimatedTotal;
document.getElementById("progress").style.width=
Math.min((comparisons/estimatedTotal)*100,100)+"%";
}

function choose(side){
history.push({left:[...left],right:[...right],merged:[...merged],stack:[...stack]});
comparisons++;
if(side==="A"){merged.push(left.shift());}
else{merged.push(right.shift());}
show();
}

function forceKeep(side){
if(side==="A"){keepForced.push(left.shift());}
else{keepForced.push(right.shift());}
show();
}

function forceDiscard(side){
if(side==="A"){discardForced.push(left.shift());}
else{discardForced.push(right.shift());}
show();
}

function goBack(){
if(!history.length)return;
let prev=history.pop();
left=prev.left;right=prev.right;
merged=prev.merged;stack=prev.stack;
comparisons--;
show();
}

function finish(){
document.body.classList.remove("locked");

let ranked=stack[0];
ranked=keepForced.concat(ranked.filter(x=>!keepForced.includes(x)));
ranked=ranked.filter(x=>!discardForced.includes(x));

let keep=ranked.slice(0,target);
let discard=ranked.slice(target).concat(discardForced);

let all=[...keep,...discard];
let counts={};
all.forEach(i=>counts[i]=(counts[i]||0)+1);

function format(list){
return list.map(item=>{
let cls="";
if(counts[item]>10) cls="red";
else if(counts[item]>3) cls="yellow";
return "<div class='"+cls+"'>"+item+"</div>";
}).join("");
}

document.getElementById("compare").classList.add("hidden");
document.getElementById("results").classList.remove("hidden");

document.getElementById("results").innerHTML=
"<h2>KEEP</h2>"+format(keep)+
"<h2>DISCARD</h2>"+format(discard)+
"<br><button class='primary' onclick='exportResults()'>EXPORT TO NOTES</button>"+
"<button class='secondary' onclick='resetAll()'>RESTART</button>";
}

function exportResults(){
let text=document.getElementById("results").innerText;
if(navigator.share){
navigator.share({title:"DECIDOR Results",text:text});
}else{
navigator.clipboard.writeText(text);
alert("COPIED TO CLIPBOARD");
}
}

function resetAll(){location.reload();}
</script>

</body>
</html>
